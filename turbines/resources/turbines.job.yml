# The main job for turbines.
resources:
  jobs:
    turbines_job:
      name: turbines_job

      tasks:
        - task_key: raw_to_bronze
          # job_cluster_key: job_cluster
          existing_cluster_id: 0314-194013-7dfx96xt
          python_wheel_task:
            package_name: turbines
            entry_point: raw_to_standardized
            parameters:
              - ${var.catalog}
          libraries:
            - whl: ${var.wheel_path}

        - task_key: bronze_to_silver
          depends_on:
            - task_key: raw_to_bronze
          # job_cluster_key: job_cluster
          existing_cluster_id: 0314-194013-7dfx96xt
          python_wheel_task:
            package_name: turbines
            entry_point: standardized_to_enriched
            parameters:
              - ${var.catalog}
          libraries:
            - whl: ${var.wheel_path}

        - task_key: silver_to_gold
          depends_on:
            - task_key: bronze_to_silver
          # job_cluster_key: job_cluster
          existing_cluster_id: 0314-194013-7dfx96xt
          python_wheel_task:
            package_name: turbines
            entry_point: enriched_to_curated
            parameters:
              - ${var.catalog}
          libraries:
            - whl: ${var.wheel_path}

      job_clusters:
        - job_cluster_key: job_cluster
          new_cluster:
            spark_version: 16.2.x-scala2.12
            node_type_id: Standard_F4
            data_security_mode: SINGLE_USER
